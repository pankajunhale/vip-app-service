(()=>{"use strict";var e={752:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=a(r(860)),u=n(r(685)),d=n(r(773)),c=n(r(316)),l=a(r(582)),m=r(360),h=r(859),p=r(401),f=a(r(974)),g=a(r(311)),_=a(r(890)),y=r(380),C=i.default(),w=u.createServer(C),E=[],O=f.default("app");C.use(l.default({origin:"*"})),C.use(i.default.json()),C.use(i.default.urlencoded({extended:!0})),C.use("/static",i.default.static("/assets/resources"));const I={transports:[new d.transports.Console],format:d.format.combine(d.format.json(),d.format.prettyPrint(),d.format.colorize({all:!0}))};({SERVER:"qa",API_PORT:"3030"}).DEBUG||(I.meta=!1),C.use(c.logger(I)),E.push(new m.BigBazaarRoutes(C)),E.push(new h.CustomerRoutes(C)),E.push(new p.MapperManagerRoutes(C)),E.push(new y.DashboardReportRoutes(C));const v="Server running in environment:qa, Port:3030";C.get("/",((e,t)=>{t.status(200).send(v+" : "+new Date)})),w.listen("3030",(()=>{E.forEach((e=>{O(`Routes configured for ${e.getName()}`)})),console.log(v)})),g.default.schedule("* * * * *",(()=>{_.default.processPurchaseOrderJob()}))},360:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BigBazaarRoutes=void 0;const s=r(888),n=o(r(890)),a=o(r(890));class i extends s.CommonRoutesConfig{constructor(e){super(e,"BigBazaarRoutes")}configureRoutes(){return this.app.route("/purchase-order/list").get(n.default.listPurchaseOrders),this.app.route("/purchase-order/details/:masterId").get(n.default.getPurchaseOrderDetailsByMasterId),this.app.route("/purchase-order/create").get(a.default.createPurchaseOrder),this.app.route("/purchase-order/master").get(a.default.getPurchaseOrderMaster),this.app}}t.BigBazaarRoutes=i},890:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(541)),a=s(r(974)),i=r(691),u=r(833),d=s(r(147)),c=a.default("app:users-controller");t.default=new class{constructor(){this.db=new i.PurchaseOrderDb}listPurchaseOrders(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started listPurchaseOrders():  ");const e=yield n.default.list().then((e=>e));t.json({data:e})}catch(e){const{message:r}=e;t.status(500).send("Error in fetching purchase order master data!"+r)}}))}getPurchaseOrderDetailsByMasterId(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getPurchaseOrderDetailsByMasterId(): "),console.log("masterId: ",e.params.masterId);const r=yield n.default.listPurchaseOrderDetails(parseInt(e.params.masterId)).then((e=>e));t.json({data:r})}catch(e){const{message:r}=e;t.status(500).send("Error in fetching purchase order details data!"+r)}}))}createPurchaseOrder(e,t){return o(this,void 0,void 0,(function*(){try{const r=yield n.default.create(e.body);t.status(200).send({data:r})}catch(e){t.status(500).send({error:"some error"})}}))}removePurchaseOrder(e,t){return o(this,void 0,void 0,(function*(){c(yield n.default.deleteById(e.body.purchaseOrderId)),t.status(204).send()}))}getPurchaseOrderMaster(e,t){return o(this,void 0,void 0,(function*(){try{const{page:r}=e.query;console.log(r);const o=yield n.default.getPurchaseOrderMasterByDate(r);t.status(200).send({data:o})}catch(e){console.log(e);const{message:r}=e;t.status(500).send({error:`Error:- ${r}`})}}))}processPurchaseOrderJob(){return o(this,void 0,void 0,(function*(){console.log("started processPurchaseOrderJob(): "),yield this.db.getAllOpenPurchaseOrders().then((e=>{e&&e.length>0?e.map((e=>{const t=process.cwd(),r=`${t}\\${e.json_file_path}`;console.log(t,r),d.default.existsSync(e.json_file_path)?(console.log(r,"exist"),e.json_file_name=r,this.processPurchaseOrder(e)):console.log("not exist")})):console.log("There are no Jobs to process!")}))}))}processPurchaseOrder(e){return o(this,void 0,void 0,(function*(){try{const t=new u.BigBazaarPurchaseOrderDto;t.Id=e.id,t.PurchaseOrderMasterId=e.purchase_order_master_id,t.MesageId=e.message_id,t.IsPdfConvertedToJson=e.is_pdf_converted_to_json,t.JsonFile=e.json_file_name,t.JsonFilePath=e.json_file_path;const r=yield this.db.getCustomerBySenderEmailId(e.email_from);t.CustomerId=r,t.TemplateHeaderLabel=yield this.db.getTemplateHeaderDetailsByCustomerId(t.CustomerId),t.TemplateItemLabel=yield this.db.getTemplateOrderItemDetailsByCustomerId(t.CustomerId),console.log(t),yield n.default.create(t)}catch(e){const{message:t}=e;console.log(e,t)}}))}getTemplateLabelListByFlag(e,t){return e.filter((e=>e.IsHeader===t))}}},657:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&o(t,e,r);return s(t,e),t},a=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=i(r(974)),d=i(r(147)),c=n(r(681)),l=i(r(314)),m=r(98),h=r(756),p=r(691),f=u.default("app:in-memory-dao");t.default=new class{constructor(){this.db=new p.PurchaseOrderDb,f("Created new instance of BigBazaarDAO")}processAndCreatePO(e){return a(this,void 0,void 0,(function*(){try{let t=null,r=[];const o=d.default.readFileSync(e.JsonFilePath),s=JSON.parse(o);if(o&&s.length>=2){for(let e=0;e<s[2].data.length;e++){const r=s[2].data[e];2===e&&(t=c.default.pluck(r,"text"))}console.log(t),c.default.map(s,(e=>{"lattice"===e.extraction_method&&c.default.map(e.data,(e=>{let t=[];c.default.map(e,(e=>{e.text&&(e.text.split("\r"),t=t.concat(e.text))})),r.push(t)}))}))}const n=r.filter((t=>{if(e.TemplateItemLabel.length>0)return t.length===e.TemplateItemLabel[0].OrderItemTableCount}));n&&n.length>0&&(e.ItemsHeader=n),this.setPurchaseOrderHeader(e,s);const a=this.getPurchaseOrderItems(e,r),i=new Array;return c.default.map(a,(e=>{const t=new m.BigBazaarPurchaseOrderItemsDto;c.default.map(e,(e=>{"EAN"===e.label&&(t.ArticleEAN=e.value),"SKU"===e.label&&(t.ArticleCode=e.value),"Description"===e.label&&(t.DescriptionOfGoods=e.value),"HSN"===e.label&&(t.HSN=e.value),"MRP"===e.label&&(t.MRP=e.value),"Quantity"===e.label&&(t.Quantity=e.value),"UoM"===e.label&&(t.UnitOfMeasure=e.value),"Basic Cost"===e.label&&(t.BasicCost=e.value),"Taxable Value"===e.label&&(t.TaxableAmount=e.value),"SGST Amount"===e.label&&(t.SGST_Amount=e.value),"SGST Rate"===e.label&&(t.SGST_Rate=e.value),"CGST Amount"===e.label&&(t.CGST_Amount=e.value),"CGST Rate"===e.label&&(t.CGST_Rate=e.value),"Total Amount"===e.label&&(t.TotalAmount=e.value)})),i.push(t)})),e.Items=i,e.Id&&this.db.updatePurchaseOrderMaster(e),console.log(e),e}catch(t){const{message:r}=t;throw console.log(`Error in processing Purchase Order - ${e.JsonFile} - ${r}`),new Error(`Error in processing Purchase Order - ${e.JsonFile} - ${r}`)}}))}getPurchaseOrderMaster(){return a(this,void 0,void 0,(function*(){try{return this.db.getAllPurchaseOrderMaster()}catch(e){throw new Error("Error in processing your request")}}))}getPurchaseOrderDetailsById(e){return a(this,void 0,void 0,(function*(){try{return this.db.getAllPurchaseOrderDetailsById(e)}catch(e){throw new Error("Error in processing your request")}}))}getPurchaseOrderMaterByDate(e){return a(this,void 0,void 0,(function*(){return this.db.getMultiple(e)}))}setPurchaseOrderHeader(e,t){const r=e.TemplateHeaderLabel;c.map(r,(o=>{const s=this.newMappgingLogic(t,this.getPdfMapperByOutputFieldName(o.OutputFieldName,r)),n=this.getPurchaseOrderHeaderValue(s,o);o.OutputFieldName.toLowerCase().trim()==="purchase order number".trim()&&(e.PurchaseOrderNumber=n),o.OutputFieldName.toLowerCase().trim()==="purchase order date".trim()&&(e.PurchaseOrderDate=n),o.OutputFieldName.toLowerCase().trim()==="sold to party".trim()&&(e.SoldToParty=s),o.OutputFieldName.toLowerCase().trim()==="ship to party".trim()&&(e.ShipToParty=s)}))}getPurchaseOrderItems(e,t){const r=e.TemplateItemLabel;console.log(r[0].OrderItemTableCount);let o=r[0].OrderItemTableCount;const s=[],n=(new Set(r.map((e=>e.ColumnIndex))),l.default.filterRawJsonListByLength(t,o,e.ItemsHeader));return console.log("Imp:",n),c.default.map(n,((t,o)=>{if(!this.isOrderItemContainTableHeader(e.ItemsHeader,t)){const e=[];c.default.map(r,((o,s)=>{const n=this.getItemDetailsByColumnIndexNew(o.ColumnIndex,r);n&&c.default.isArray(n)&&n.length>0&&c.default.map(n,((r,o)=>{const s={labelInfo:r,value:"",label:""};if(1!==r.FieldCount){const e=l.default.splitString(t[r.ColumnIndex],"\r");if(e&&e.length>0&&(s.value=e[o],s.label=r.OutputFieldName),"Description"===s.label){s.value="";for(let t=0;t<e.length;t++)t>=2&&(s.value=`${s.value} ${e[t]}`)}}if(1===r.FieldCount){const e=l.default.splitString(t[r.ColumnIndex],"\r");if(e&&e.length>0){for(let t=0;t<e.length;t++)s.value=`${s.value} ${e[t]}`;s.label=r.OutputFieldName}}e.push(s)}))})),s.push(e)}})),console.log(s.length),s}getItemDetailsByColumnIndexNew(e,t){return t.filter(((t,r)=>{if(t.ColumnIndex===e)return t}))}getPOHeaders(e){const t=Array();return e.map(((e,r)=>{const o=l.default.splitString(e,"\r");if(o&&o.length>1)o.map(((e,o)=>{const s=new h.BigBazaarPurchaseOrderItemsHeader("\r");s.hasSeparator=!0,s.index=r,s.name=e,t.push(s)}));else{const o=new h.BigBazaarPurchaseOrderItemsHeader("\r");o.index=r,o.name=e,o.columnIndex=r,t.push(o)}})),t}getPurchaseOrderHeaderValue(e,t){let r="";if(e){const o=l.default.splitString(e,t.SeparatedBy);o&&o.length>1&&(r=l.default.filterRawJsonListBySearchTerm(o,t.SearchTerm,t.InputFieldName,t.OutputFieldName))}return r}getPdfMapperByOutputFieldName(e,t){return t.find((t=>t.OutputFieldName.toLowerCase()===e.toLowerCase()))}newMappgingLogic(e,t){let r,o,s,n="";if(t){const a=l.default.splitString(t.MapperIndex,"-");a&&3===a.length&&(r=parseInt(a[0]),o=parseInt(a[1]),s=parseInt(a[2]),c.default.map(e,((e,t)=>{"lattice"===e.extraction_method&&c.default.map(e.data,((e,a)=>{c.default.map(e,((e,i)=>{e.text&&t===r&&a===o&&i===s&&(n=e.text,console.log(`${t}-${a}-${i}-${n}`))}))}))})))}return n}isOrderItemContainTableHeader(e,t){let r=!1;return t.map(((t,o)=>{if(t&&t.includes(e[0]))return r=!0,r})),console.log(r),r}}},833:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BigBazaarPurchaseOrderDto=void 0,t.BigBazaarPurchaseOrderDto=class{constructor(){this.CustomerId=0,this.Id=0,this.PurchaseOrderMasterId=0,this.PurchaseOrderNumber="",this.SoldToParty="",this.ShipToParty="",this.PurchaseOrderDate="",this.ValidTo="",this.OrderType="",this.SalesOrg="",this.DistChannel="",this.Division="",this.StorageLocation="",this.Plant="",this.OrderReason="",this.ConditonType="",this.ItemsHeader=[],this.ItemColumnHeaders=[],this.Items=[],this.MesageId=0,this.IsPdfConvertedToJson=!1,this.JsonFile="",this.JsonFilePath="",this.TemplateMappingInformation=[],this.TemplateHeaderLabel=[],this.TemplateItemLabel=[],this.init()}init(){this.OrderType="ZQHT",this.SalesOrg="VIPL",this.DistChannel="MT",this.Division="HL"}}},98:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BigBazaarPurchaseOrderItemsDto=void 0,t.BigBazaarPurchaseOrderItemsDto=class{constructor(){this.Id=0,this.PurchaseOrderMasterId=0,this.SAPMatCode="",this.ArticleEAN="",this.ArticleCode="",this.DescriptionOfGoods="",this.Quantity="",this.UnitOfMeasure="",this.TaxableAmount="",this.HSN="",this.MRP="",this.BasicCost="",this.SGST_Rate="",this.SGST_Amount="",this.CGST_Rate="",this.CGST_Amount="",this.TotalAmount=""}}},756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BigBazaarPurchaseOrderItemsHeader=void 0,t.BigBazaarPurchaseOrderItemsHeader=class{constructor(e){this.index=-1,this.hasSeparator=!1,this.name="",this.columnIndex=-1,this.splitBy=e}findIndex(e,t){let r=-1;return t.map(((t,o)=>{t=t.toLowerCase().trim(),e=e.toLowerCase().trim(),-1!==t.indexOf(e)&&(r=o)})),r}findColumnIndex(e,t){let r=-1;return t.map(((t,o)=>{t.toLowerCase().trim()===e.toLowerCase().trim()&&(r=o)})),r}}},546:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateMapperInfoDto=void 0,t.TemplateMapperInfoDto=class{constructor(){this.Id=0,this.CustomerId=0,this.InputFieldName="",this.OutputFieldName="",this.SeparatedBy="",this.MapperIndex="",this.ColumnIndex=-1,this.FieldCount=-1,this.IsHeader=!1,this.GroupName="",this.OrderItemTableCount=0,this.SearchTerm=""}}},541:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(657));t.default=new class{create(e){return o(this,void 0,void 0,(function*(){try{return n.default.processAndCreatePO(e)}catch(t){throw new Error(`Error in processing Purchase Order - ${e.JsonFile}`)}}))}list(){return o(this,void 0,void 0,(function*(){return n.default.getPurchaseOrderMaster()}))}listPurchaseOrderDetails(e){return o(this,void 0,void 0,(function*(){return n.default.getPurchaseOrderDetailsById(e)}))}deleteById(e){return o(this,void 0,void 0,(function*(){return""}))}getPurchaseOrderMasterByDate(e){return o(this,void 0,void 0,(function*(){try{return n.default.getPurchaseOrderMaterByDate(e)}catch(e){throw new Error("Error in processing your request")}}))}}},888:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommonRoutesConfig=void 0,t.CommonRoutesConfig=class{constructor(e,t){this.app=e,this.name=t,this.configureRoutes()}getName(){return this.name}}},314:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(681));t.default=new class{constructor(){}splitString(e,t){let r=new Array;return e&&t&&e.length>0&&(r=e.split(t)),r}filterRawJsonListByLength(e,t,r){return e.filter(((e,r)=>{if(e&&e.length===t)return e}))}filterRawJsonListBySearchTerm(e,t,r,o){let n="";return s.default.map(e,((r,o)=>{console.log(r),r.includes(t)&&(n||(n=e[o+1]))})),n}}},913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBConfig=void 0,t.DBConfig=class{constructor(){this.config=()=>(console.log("current env:","qa"),this.qaConfig())}developmentConfig(){return{db:{host:"localhost",user:"root",password:"vip@123456",database:"vip-po-automation-dev-db",port:3306},listPerPage:10}}qaConfig(){return{db:{host:"148.72.214.82",user:"root",password:"123456",database:"vip-po-automation-dev-db",port:3306},listPerPage:10}}prodConfig(){return{db:{host:"localhost",user:"root",password:"vip@123456",database:"vip-po-automation-dev-db",port:3306},listPerPage:10}}}},422:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(974)),a=r(426),i=r(201),u=r(221);n.default("app:customer-controller"),t.default=new class{getCustomer(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getCustomer(): ");const r=parseInt(e.params.id),o=yield(new a.CustomerDb).find(r);t.status(200).send(o[0])}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}listCustomers(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started listCustomers(): ");const e=yield(new a.CustomerDb).findAll();t.status(200).send(e)}catch(e){const{message:r}=e;t.status(500).send("Error in processing listing customer data!"+r)}}))}validateCustomerDomain(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started validateCustomerDomain(): ",e.body),e.params.domainName;const r=yield(new a.CustomerDb).isCustomerDomainExist(e.body,"").then((e=>e));t.json({isDomainExist:r})}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}createCustomer(e,t){return o(this,void 0,void 0,(function*(){try{if(yield i.uploadFileMiddleware(e,t),null==e.file)return t.status(400).send({message:"Please upload a file!"});const r=new a.CustomerDb;console.log("started createCustomer(): ",JSON.parse(e.body.model));const o=e.file,s=JSON.parse(e.body.model);s.PurchaseOrderPdfTemplate=`${o.originalname}`,o.originalname=s.PurchaseOrderPdfTemplate;const n="CREATE",d=new u.CustomerValidationInfoDto,c=yield r.isCustomerAlreadyExist(s,n);if(console.log("isCustomerDuplicate:",c),c)return t.status(500).send({data:d.getErrorByCode(d.DUPLICATE_CUSTOMER)});const l=yield r.isCustomerDomainExist(s,n);if(console.log("isCustomerDomainDuplicate:",l),l){if(s.SenderEmailId){const e=yield r.isDomainAndSenderEmailDomainValid(s,n);if(console.log("isCustomerDomainAndSenderEmailValid:",e),e)return t.status(500).send({data:d.getErrorByCode(d.DUPLICATE_SENDER_ID)})}return t.status(500).send({data:d.getErrorByCode(d.DUPLICATE_DOMAIN)})}const m=yield r.insertCustomer(s).then((e=>e));t.json({customer:m})}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}updateCustomer(e,t){return o(this,void 0,void 0,(function*(){try{yield i.uploadFileMiddleware(e,t);const r=JSON.parse(e.body.model);console.log("started updateCustomer(): ",r);const o=new a.CustomerDb,s="UPDATE",n=new u.CustomerValidationInfoDto,d=yield o.isCustomerAlreadyExist(r,s);if(console.log("isCustomerDuplicate:",d),d)return t.status(500).send({data:n.getErrorByCode(n.DUPLICATE_CUSTOMER)});const c=yield o.isCustomerDomainExist(r,s);if(console.log("isCustomerDomainDuplicate:",c),c){if(r.SenderEmailId){const e=yield o.isDomainAndSenderEmailDomainValid(r,s);if(console.log("isCustomerDomainAndSenderEmailValid:",e),e)return t.status(500).send({data:n.getErrorByCode(n.DUPLICATE_SENDER_ID)})}return t.status(500).send({data:n.getErrorByCode(n.DUPLICATE_DOMAIN)})}const l=yield(new a.CustomerDb).updateCustomerInformaion(r).then((e=>e));t.json({customer:l})}catch(e){const{message:r}=e;t.status(500).send("Error in updating data!"+r)}}))}}},859:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerRoutes=void 0;const s=r(888),n=o(r(422));class a extends s.CommonRoutesConfig{constructor(e){super(e,"CustomerRoutes")}configureRoutes(){return this.app.route("/customer/details/:id").get(n.default.getCustomer),this.app.route("/customer/list").get(n.default.listCustomers),this.app.route("/customer/create").post(n.default.createCustomer),this.app.route("/customer/update/:id").post(n.default.updateCustomer),this.app.route("/customer/validation/domain/:domainName").get(n.default.validateCustomerDomain),this.app}}t.CustomerRoutes=a},221:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerValidationInfoDto=void 0,t.CustomerValidationInfoDto=class{constructor(){this.DUPLICATE_CUSTOMER="DUPLICATE_CUSTOMER",this.DUPLICATE_DOMAIN="DUPLICATE_DOMAIN",this.DUPLICATE_SENDER_ID="DUPLICATE_SENDER_ID",this.INVALID_FILE_EXTENSION="INVALID_FILE_EXTENSION",this.EMPTY_FILE="EMPTY_FILE",this.ERROR_CODE_INFO=[{key:this.DUPLICATE_CUSTOMER,errorCode:452,message:"Customer already exist."},{key:this.DUPLICATE_DOMAIN,errorCode:453,message:"Customer domain already exist, please enter unique sender email id."},{key:this.DUPLICATE_SENDER_ID,errorCode:454,message:"Customer domain with sender emailId already exist."},{key:this.INVALID_FILE_EXTENSION,errorCode:455,message:"Invalid file format, only PDF files are allowed."},{key:this.EMPTY_FILE,errorCode:456,message:"Invalid file format, file is empty."}]}getErrorByCode(e){return this.ERROR_CODE_INFO.find((t=>t.key===e))}}},699:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(974)),a=r(191);n.default("app:manage-mapper-controller"),t.default=new class{constructor(){}getDashboardData(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getDashboardData(): "),console.log("UserId: ",e.params.userId),console.log("Body Params: ",e.body);const r={totalCustomers:0,totalPurchaseOrders:0,totalSuccessfullyProcessed:0,totalFailedOrders:0,totalDownloads:0,todaysData:{totalPurchaseOrders:0,totalSuccessfullyProcessed:0,totalFailedOrders:0},topFive:{customers:[],purchaseOrders:null}},o=new a.DashboardReportDb;if(r.totalCustomers=yield o.findTotalCustomers(),r.totalPurchaseOrders=yield o.findTotalOrders(),r.totalSuccessfullyProcessed=yield o.findTotalSuccessfullyProcessedOrders(e.body),r.totalFailedOrders=yield o.findTotalFailedOrders(e.body),r.totalDownloads=yield o.findTotalDowonloadedOrders(e.body),r.todaysData.totalPurchaseOrders=yield o.findTodaysOrders(),r.todaysData.totalSuccessfullyProcessed=yield o.findTodaysSuccessfullyProcessedOrders(),r.todaysData.totalFailedOrders=yield o.findTodaysFailedOrders(),r.topFive.customers=yield o.findTopFiveCustomers(e.body),r.topFive.customers)for(let t=0;t<r.topFive.customers.length;t++){const s=r.topFive.customers[t],n=s.email_from.split("@")[1];s.received=yield o.findTopFivePurchaseOrderByCustomerDomain(!0,n,1,0,e.body),s.processed=yield o.findTopFivePurchaseOrderByCustomerDomain(!1,n,1,1,e.body),s.failed=yield o.findTopFivePurchaseOrderByCustomerDomain(!1,n,1,0,e.body)}r.topFive.purchaseOrders=yield o.findTopFivePurchaseOrders(e.body),t.json({dashboardInfo:r})}catch(e){const{message:r}=e;t.status(500).send("Error in fetching dashboard data!"+r)}}))}getPurchaseOrderData(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getPurchaseOrderData(): "),console.log("UserId: ",e.params.userId),console.log("Data: ",e.body);const r=new a.DashboardReportDb;let o=yield r.filterPurchaseOrderInformation(e.params.userId,e.body);t.json({data:o})}catch(e){const{message:r}=e;t.status(500).send("Error in fetching PurchaseOrderdata!"+r)}}))}getAllDistinctEmails(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getAllDistinctDomains(): "),console.log("Input: ",e.params.userId);const r=new a.DashboardReportDb;let o=yield r.findAllDistinctEmailList();t.json({data:o})}catch(e){const{message:r}=e;t.status(500).send("Error in fetching Deomain List!"+r)}}))}downloadPurchaseOrderPdf(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started findPurchaseOrderPdf(): "),console.log("File Name: ",e.params.fileName),console.log("Present working directory: "+process.cwd()),process.chdir(process.cwd()+"..\\..\\..\\automation\\download-po\\");const r=`${process.cwd()}\\${e.params.fileName}`;console.log(r),t.download(r,(function(e){e?(console.log("Error"),console.log(e),t.status(500).send("Error in processing getting customer PO data!"+e)):console.log("Success")}))}catch(e){const{message:r}=e;t.status(500).send("Error in processing getting customer PO data!"+r)}}))}}},380:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DashboardReportRoutes=void 0;const s=r(888),n=o(r(699));class a extends s.CommonRoutesConfig{constructor(e){super(e,"DashboardReportRoutes")}configureRoutes(){return this.app.route("/dashboard/report/:userId").post(n.default.getDashboardData),this.app.route("/report/purchase-order/:userId").post(n.default.getPurchaseOrderData),this.app.route("/email/list/:userId").get(n.default.getAllDistinctEmails),this.app.route("/download/purchase-order/:fileName").get(n.default.downloadPurchaseOrderPdf),this.app}}t.DashboardReportRoutes=a},105:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(974)),a=s(r(147)),i=r(654);n.default("app:manage-mapper-controller"),t.default=new class{constructor(){}getMapperDetails(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getMapperInformation(): "),console.log("CustomerId: ",e.params.customerId);const r=yield(new i.MapperManagerDb).find(parseInt(e.params.customerId)).then((e=>e));t.json({mapperInfo:r})}catch(e){const{message:r}=e;t.status(500).send("Error in processing fetching output field data!"+r)}}))}createMapper(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started createMapper(): ",e.body),console.log("CustomerId: ",e.params.customerId);const r=new i.MapperManagerDb;yield(new i.MapperManagerDb).deleteExistingMapperInformation(parseInt(e.params.customerId));const o=yield r.insertMapperInformation(e.body).then((e=>e));t.json({mapper:o})}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}findPurchaseOrderTemplate(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started findPurchaseOrderTemplate(): ");const r=e.params.customerId,o=e.params.fileName;console.debug(r,o),a.default.readFile(`${o}`,"utf8",((e,r)=>{e?t.status(500).send(e):t.status(200).send(r)}))}catch(e){const{message:r}=e;t.status(500).send("Error in processing getting customer PO-Template data!"+r)}}))}createHeaderOutputFieldMapper(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started createHeaderOutputFieldMapper(): ",e.body),console.log("CustomerId: ",e.params.customerId);const r=new i.MapperManagerDb,o=r.getOutputFieldDataForSave(e.body,!1),s=r.getOutputFieldDataForSave(e.body,!0);let n,a;const u=e.body.TableColumnCount;o.length&&(n=yield r.insertOutputFieldInformation(o,u).then((e=>e))),s.length&&(a=yield r.updateOutputFields(s,u).then((e=>e))),t.json({result:{insert:n,update:a}})}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}createDetailOutputFieldMapper(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started createDetailOutputFieldMapper(): ",e.body),console.log("CustomerId: ",e.params.customerId);const r=new i.MapperManagerDb,o=r.getOutputFieldDataForSave(e.body.DetailItems,!1),s=r.getOutputFieldDataForSave(e.body.DetailItems,!0);let n,a,u=0;e.body.TableColumnCount||t.status(500).send("Invalid table column count.");try{u=parseInt(e.body.TableColumnCount)}catch(e){t.status(500).send("Invalid table column count.")}o.length&&(n=yield(new i.MapperManagerDb).insertOutputFieldInformation(o,u).then((e=>e))),s.length&&(a=yield r.updateOutputFields(s,u).then((e=>e))),t.json({result:{insert:n,update:a}})}catch(e){const{message:r}=e;t.status(500).send("Error in processing inserting data!"+r)}}))}getAllTemplateOutputFieldsForDetails(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getAllTemplateOutputFieldsForDetails(): "),console.log("CustomerId: ",e.params.customerId);const r=yield(new i.MapperManagerDb).findAllOutputFieldsForDetails(parseInt(e.params.customerId)).then((e=>e));t.json({mapperInfo:r})}catch(e){const{message:r}=e;t.status(500).send("Error in processing fetching output field data!"+r)}}))}getAllTemplateOutputFieldsForHeader(e,t){return o(this,void 0,void 0,(function*(){try{console.log("started getAllTemplateOutputFieldsForHeader(): "),console.log("CustomerId: ",e.params.customerId);const r=yield(new i.MapperManagerDb).findAllOutputFieldsForHeader(parseInt(e.params.customerId)).then((e=>e));t.json({mapperInfo:r})}catch(e){const{message:r}=e;t.status(500).send("Error in processing fetching output field data!"+r)}}))}}},401:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MapperManagerRoutes=void 0;const s=r(888),n=o(r(105));class a extends s.CommonRoutesConfig{constructor(e){super(e,"MapperManagerRoutes")}configureRoutes(){return this.app.route("/mapper/create/:customerId").post(n.default.createMapper),this.app.route("/mapper/details/:customerId").get(n.default.getMapperDetails),this.app.route("/mapper/template/:customerId/:fileName").get(n.default.findPurchaseOrderTemplate),this.app.route("/mapper/:customerId/template-output-field/order-details/list").get(n.default.getAllTemplateOutputFieldsForDetails),this.app.route("/mapper/:customerId/template-output-field/order-header/list").get(n.default.getAllTemplateOutputFieldsForHeader),this.app.route("/mapper/create/header-template-output-field/:customerId").post(n.default.createHeaderOutputFieldMapper),this.app.route("/mapper/create/detail-template-output-field/:customerId").post(n.default.createDetailOutputFieldMapper),this.app}}t.MapperManagerRoutes=a},426:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomerDb=void 0;const s=r(154),n=r(378),a=r(913),i=r(221);t.CustomerDb=class{constructor(){this.db=new s.DB,this.config=(new a.DBConfig).config(),this.helper=new n.DB_Helper,this.insertCustomer=e=>new Promise(((t,r)=>{const o=this.db.getConnectionPool(),s=(new Date).toISOString().slice(0,19).replace("T"," "),n=[`${e.Name}`,`${e.ShortName}`,`${e.DomainName.toLowerCase()}`,`${e.Address}`,e.CountryId,e.StateId,e.CityId,`${e.PurchaseOrderPdfTemplate}`,`${e.CustomerContactName}`,`${e.CustomerContactEmail}`,`${e.CustomerContactNumber}`,`${e.SenderEmailId}`,e.IsTemplateMapped,e.CreatedBy,s];o.query(this.getInsertQuery(),n,((e,o)=>e?r(e):t(o.insertId)))})),this.getInsertQuery=()=>"INSERT INTO customer_information (\n      name,\n      short_name,\n      domain_name,\n      address,\n      country_id,\n      state_id,\n      city_id,\n      purchase_order_pdf_template,\n      customer_contact_name,\n      customer_contact_email,\n      customer_contact_number,\n      sender_email_id,\n      is_template_mapped,\n      created_by,\n      created_at\n     ) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"}find(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT * FROM customer_information where id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findAll(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("SELECT * FROM customer_information",((r,o)=>r?t(r):e(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}isCustomerAlreadyExist(e,t){return o(this,void 0,void 0,(function*(){try{return new Promise(((r,o)=>{let s="";s="CREATE"===t?`SELECT * FROM customer_information where LOWER(name) = '${e.Name.toLowerCase()}' `:`SELECT * FROM customer_information where LOWER(name) = '${e.Name.toLowerCase()}' AND id != ${e.Id}`,this.db.getConnectionPool().query(s,((e,t)=>{if(e)return o(e);let s=!1;return t.length&&(s=!0),r(s)}))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}isCustomerDomainExist(e,t){return o(this,void 0,void 0,(function*(){try{return new Promise(((r,o)=>{let s="";s="CREATE"===t?`SELECT * FROM customer_information where LOWER(domain_name) = '${e.DomainName.toLowerCase()}' `:`SELECT * FROM customer_information where LOWER(domain_name) = '${e.DomainName.toLowerCase()}' AND id != ${e.Id}`,this.db.getConnectionPool().query(s,((e,t)=>{if(e)return o(e);let s=!1;return t.length&&(s=!0),r(s)}))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}isDomainAndSenderEmailDomainValid(e,t){return o(this,void 0,void 0,(function*(){try{return new Promise(((r,o)=>{let s="";s="CREATE"===t?`SELECT * FROM customer_information \n          where LOWER(domain_name) = '${e.DomainName.toLowerCase()}' \n          AND LOWER(sender_email_id) LIKE '%${e.SenderEmailId.toLowerCase()}%'`:`SELECT * FROM customer_information \n          where LOWER(domain_name) = '${e.DomainName.toLowerCase()}'\n          AND LOWER(sender_email_id) LIKE '%${e.SenderEmailId.toLowerCase()}%'\n          AND id != ${e.Id}`,this.db.getConnectionPool().query(s,((e,t)=>{if(e)return o(e);let s=!1;return t.length&&(s=!0),r(s)}))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}updateTemplateInfo(e){return o(this,void 0,void 0,(function*(){try{const t=(new Date).toISOString().slice(0,19).replace("T"," ");return new Promise(((r,o)=>{this.db.getConnectionPool().query(`UPDATE customer_information \n            SET\n              is_template_mapped = ${e.IsTemplateMapped}\n              updated_by = ${e.UpdatedBy},\n              updated_at = "${t}"\n            WHERE\n              id = ${e.Id}\n          `,((e,t)=>e?o(e):r(t.affectedRows)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}updateCustomerInformaion(e){return o(this,void 0,void 0,(function*(){try{const t=(new Date).toISOString().slice(0,19).replace("T"," ");return new Promise(((r,o)=>{this.db.getConnectionPool().query(`UPDATE customer_information \n            SET\n              name = "${e.Name}",\n              short_name = "${e.ShortName}",\n              domain_name = "${e.DomainName.toLowerCase()}",\n              address = "${e.Address}",\n              country_id = ${e.CountryId},\n              state_id = ${e.StateId},\n              city_id = ${e.CityId},\n              customer_contact_name = "${e.CustomerContactName}",\n              customer_contact_email = "${e.CustomerContactEmail}",\n              customer_contact_number = "${e.CustomerContactNumber}",\n              sender_email_id = "${e.SenderEmailId}",              \n              updated_by = ${e.UpdatedBy},\n              updated_at = "${t}"\n            WHERE\n              id = ${e.Id}\n          `,((e,t)=>e?o(e):r(t.affectedRows)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}validateCustomerBeforeSaving(e,t,r){return o(this,void 0,void 0,(function*(){const o=new i.CustomerValidationInfoDto;return(yield this.isCustomerAlreadyExist(t,e))?r.status(500).send({data:o.getErrorByCode(o.DUPLICATE_CUSTOMER)}):(yield this.isCustomerDomainExist(t,e))?r.status(500).send({data:o.getErrorByCode(o.DUPLICATE_DOMAIN)}):(yield this.isDomainAndSenderEmailDomainValid(t,e))?r.status(500).send({data:o.getErrorByCode(o.DUPLICATE_SENDER_ID)}):void 0}))}}},191:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DashboardReportDb=void 0;const s=r(154),n=r(378),a=r(913);t.DashboardReportDb=class{constructor(){this.db=new s.DB,this.config=(new a.DBConfig).config(),this.helper=new n.DB_Helper}findTotalCustomers(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("select COUNT(*) as total_customers from customer_information",((r,o)=>r?t(r):e(o[0].total_customers)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTotalOrders(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("select COUNT(*) as total_orders from purchase_order_master",((r,o)=>r?t(r):e(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTotalSuccessfullyProcessedOrders(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`select COUNT(*) as total_orders \n        from purchase_order_master \n        where purchase_order_number IS NOT NULL AND is_json_parsed = 1\n        ${this.getBetweenClause(e)}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTotalFailedOrders(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`select COUNT(*) as total_orders from purchase_order_master \n        where purchase_order_number IS NULL\n        ${this.getBetweenClause(e)}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTotalDowonloadedOrders(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`select COUNT(*) as total_downloads from purchase_order_master \n        where is_pdf_downloaded = 1 \n        ${this.getBetweenClause(e)}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o[0].total_downloads)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTodaysOrders(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("select COUNT(*) as total_orders from purchase_order_master \n        where DATE(created_at) = CURDATE()",((r,o)=>r?t(r):e(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTodaysSuccessfullyProcessedOrders(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("select COUNT(*) as total_orders from purchase_order_master \n        where DATE(created_at) = CURDATE() \n        AND purchase_order_number IS NOT NULL \n        AND is_json_parsed = 1",((r,o)=>r?t(r):e(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTodaysFailedOrders(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("select COUNT(*) as total_orders from purchase_order_master \n        where DATE(created_at) = CURDATE() AND purchase_order_number IS NULL",((r,o)=>r?t(r):e(o[0].total_orders)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTopFiveCustomers(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT DISTINCT(email_from) FROM purchase_order_master\n        WHERE DATE(created_at) BETWEEN '${e.startDate}' AND '${e.endDate}'\n        ORDER BY created_at DESC LIMIT 5`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTopFivePurchaseOrderByCustomerDomain(e,t,r,s,n){return o(this,void 0,void 0,(function*(){try{return new Promise(((o,a)=>{let i="";i=e?`select count(*) as total_count from purchase_order_master where \n          email_from LIKE '%${t.toLowerCase()}%'\n          AND is_pdf_downloaded = ${r}         \n          ${this.getBetweenClause(n)}`:`select count(*) as total_count from purchase_order_master where \n          email_from LIKE '%${t.toLowerCase()}%'\n          AND is_pdf_downloaded = ${r} \n          AND is_json_parsed = ${s}\n          ${this.getBetweenClause(n)}`,this.db.getConnectionPool().query(i,((e,t)=>e?a(e):o(t[0].total_count)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findTopFivePurchaseOrders(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT id,email_From,pdf_file_name,purchase_order_number,DATE_FORMAT(created_at, '%d-%M-%Y') as formatted_created_at FROM purchase_order_master\n        WHERE purchase_order_number IS NOT NULL \n        ${this.getBetweenClause(e)}\n        ORDER BY created_at DESC\n        LIMIT 5`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}filterPurchaseOrderInformation(e,t){return o(this,void 0,void 0,(function*(){try{return new Promise(((r,o)=>{this.db.getConnectionPool().query("CALL sp_filter_purchase_order_data(?,?,?,?,?,?,?,?,?,?)",[e,t.PageIndex,t.PageSize,t.SearchTerm?t.SearchTerm:null,t.StartDate,t.EndDate,t.DomainName?t.DomainName:null,t.IsPODownloaded,t.IsPOParsed,t.PoStatus],((e,t)=>{if(e)return o(e);const s={recordCount:t[0][0].total_records,purchaseOrders:t[1]};return r(s)}))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findAllDistinctEmailList(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("SELECT DISTINCT(email_from) from purchase_order_master ",((r,o)=>r?t(r):e(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getBetweenClause(e){return`AND DATE(created_at) BETWEEN '${e.startDate}' AND '${e.endDate}'`}}},154:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DB=void 0;const n=s(r(744)),a=(new(r(913).DBConfig)).config(),i=n.default.createConnection(a.db),u=n.default.createPool(a.db);t.DB=class{constructor(){}query(e,t){return o(this,void 0,void 0,(function*(){yield i.connect((r=>{if(r)throw new Error("Error in connecting to server");return console.log("connected as id ",e,t),i.query(e,t,((e,t)=>{if(console.log(`${r}-${t}`),e)throw new Error("Error in processing your database request!");return t}))}))}))}getConnectionPool(){return u}}},378:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DB_Helper=void 0,t.DB_Helper=class{constructor(){}getOffset(e=1,t){return(e-1)*t}emptyOrRows(e){return e||[]}}},654:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MapperManagerDb=void 0;const s=r(154),n=r(378),a=r(913);t.MapperManagerDb=class{constructor(){this.db=new s.DB,this.config=(new a.DBConfig).config(),this.helper=new n.DB_Helper,this.deleteExistingMapperInformation=e=>new Promise(((t,r)=>{const o=`DELETE FROM mapper_detail where customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))})),this.insertMapperInformation=e=>new Promise(((t,r)=>{const o=this.db.getConnectionPool(),s=(new Date).toISOString().slice(0,19).replace("T"," ");o.query(this.getInsertQuery(),[e.map((e=>[e.CustomerId,e.IsHeader,`${e.InputFieldName}`,`${e.OutputFieldName}`,`${e.SeparatedBy}`,`${e.MapperIndex}`,e.ColumnIndex,`${e.GroupName}`,e.FieldCount,e.CreatedBy,s,`${e.SearchLabel}`]))],((e,o)=>e?r(e):t(o.insertId)))})),this.deleteExistingOutputFields=(e,t)=>new Promise(((r,o)=>{const s=`DELETE FROM output_field_mapper where customer_id = ${e} AND is_header = ${t}`;this.db.getConnectionPool().query(s,((e,t)=>e?o(e):r(t)))})),this.saveOutputFieldInformation=(e,t,r)=>{e.map((e=>{this.isOutputFieldAlreadyExist(r,t).then((t=>{e.IsExist=t}))}))},this.insertOutputFieldInformation=(e,t)=>new Promise(((r,o)=>{const s=this.db.getConnectionPool(),n=(new Date).toISOString().slice(0,19).replace("T"," ");s.query(this.getOutputFieldMapperInsertQuery(),[e.map((e=>[e.CustomerId,e.IsHeader,`${e.Name}`,`${e.ColumnIndex}`,`${e.CellFieldCount}`,t,e.CreatedBy,n]))],((e,t)=>e?o(e):r(t.insertId)))})),this.getOutputFieldMapperInsertQuery=()=>"INSERT INTO output_field_mapper (        \n        customer_id,\n        is_header,\n        name,\n        column_index,\n        field_count,\n        table_column_count,        \n        created_by,\n        created_at\n    ) VALUES ?",this.getInsertQuery=()=>"INSERT INTO mapper_detail (        \n          customer_id,\n          is_header,\n          input_field_name,\n          output_field_name,\n          separated_by,\n          mapper_index,\n          column_index,\n          group_name,\n          field_count,            \n          created_by,\n          created_at,\n          search_term\n      ) VALUES ?"}find(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT * FROM mapper_detail where customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findAllOutputFieldsForDetails(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT * FROM output_field_mapper where customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}findAllOutputFieldsForHeader(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT *, md.output_field_name as name FROM mapper_detail as md where md.customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):t(o)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}isOutputFieldAlreadyExist(e,t){return o(this,void 0,void 0,(function*(){try{return new Promise(((r,o)=>{const s=`SELECT * FROM output_field_mapper where id = ${t} AND customer_id = ${e}`;this.db.getConnectionPool().query(s,((e,t)=>{if(e)return o(e);const s=1===t.length;return r(s)}))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}updateOutputFields(e,t){try{let r;return new Promise(((o,s)=>{e.map((e=>{const o=(new Date).toISOString().slice(0,19).replace("T"," ");r=new Promise(((r,s)=>{this.db.getConnectionPool().query(`UPDATE output_field_mapper \n                SET\n                  name = "${e.Name}",\n                  column_index = ${e.ColumnIndex},\n                  field_count = ${e.CellFieldCount},\n                  table_column_count = ${t},             \n                  updated_by = ${e.CreatedBy},\n                  updated_at = "${o}"\n                WHERE\n                  id = ${e.Id}\n              `,((e,t)=>e?s(e):r(t.affectedRows)))}))})),r.then((e=>o(e))).catch((e=>s(e)))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}getOutputFieldDataForSave(e,t){let r=new Array;return e&&e.length&&(r=e.filter((e=>e.IsExist===t))),console.log("Filtered Result: ",r),r}}},201:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFileMiddleware=void 0;const o=r(837),s=r(738),n=r(282);console.log("Before Present working directory: "+n.cwd()),n.chdir(n.cwd()+"\\assets\\resources\\"),console.log("After Present working directory: "+n.cwd());let a=s.diskStorage({destination:(e,t,r)=>{const o=`${n.cwd()}`;console.debug(o),r(null,o)},filename:(e,t,r)=>{console.debug(t),r(null,t.originalname)}}),i=s({storage:a,limits:{fileSize:2097152}}).single("file");t.uploadFileMiddleware=o.promisify(i)},691:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,n){function a(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,i)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PurchaseOrderDb=void 0;const s=r(154),n=r(378),a=r(913),i=r(546);t.PurchaseOrderDb=class{constructor(){this.db=new s.DB,this.config=(new a.DBConfig).config(),this.helper=new n.DB_Helper}getMultiple(e){return o(this,void 0,void 0,(function*(){const t=this.helper.getOffset(parseInt(e),this.config.listPerPage);console.log(t,this.config.listPerPage);const r=yield this.db.query(`SELECT * FROM purchase_order_master LIMIT ${t},${this.config.listPerPage}`);return{data:this.helper.emptyOrRows(r),meta:{page:e}}}))}getAllPurchaseOrderMaster(e="2"){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=this.helper.getOffset(parseInt(e),this.config.listPerPage);console.log(o,this.config.listPerPage);const s=`select * from purchase_order_master \n        where purchase_order_number IS NOT NULL \n        LIMIT ${o},${this.config.listPerPage}\n        `;this.db.getConnectionPool().query(s,((e,o)=>e?r(e):(console.log(o),t(o))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getAllPurchaseOrderDetailsById(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`select * from purchase_order_details where purchase_order_master_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):(console.log(o),t(o))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}updatePurchaseOrderMaster(e){return o(this,void 0,void 0,(function*(){try{yield this.updatePurchaseOrderMasterInfo(e).then((t=>{this.addPurchaseOrderDetails(e,e.Items)}),(e=>{console.log(e)}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getOrderDetailInsertQuery(){return"INSERT INTO purchase_order_details (\n      purchase_order_master_id,\n      order_type, \n      sales_org, \n      distributed_channel,\n      division,\n      sold_to_party,\n      ship_to_party,\n      po_number,\n      po_date,\n      valid_to, \n      sap_material_code,\n      article_code,\n      article_ean,\n      desc_of_goods,\n      quantity,\n      uom,\n      basic_cost,\n      taxable_value,\n      sgst_rate,\n      sgst_amt,\n      cgst_rate,\n      cgst_amt,\n      total_amt,\n      hsn,\n      mrp,\n      created_at\n     ) VALUES ?"}addPurchaseOrderDetails(e,t){try{return new Promise(((r,o)=>{if(t&&t.length<=0)return o("Purchase Order Item not foun for Master ID:"+e.Id);const s=this.db.getConnectionPool(),n=(new Date).toISOString().slice(0,19).replace("T"," ");s.query(this.getOrderDetailInsertQuery(),[t.map((t=>[`${e.Id}`,`${e.OrderType}`,`${e.SalesOrg}`,`${e.DistChannel}`,`${e.Division}`,`${e.SoldToParty}`,`${e.ShipToParty}`,`${e.PurchaseOrderNumber}`,`${e.PurchaseOrderDate}`,`${e.ValidTo}`,`${t.SAPMatCode}`,`${t.ArticleCode}`,`${t.ArticleEAN}`,`${t.DescriptionOfGoods}`,`${t.Quantity}`,`${t.UnitOfMeasure}`,`${t.BasicCost}`,`${t.TaxableAmount}`,`${t.SGST_Rate}`,`${t.SGST_Amount}`,`${t.CGST_Rate}`,`${t.CGST_Amount}`,`${t.TotalAmount}`,`${t.HSN}`,`${t.MRP}`,n]))],((e,t)=>e?o(e):(console.log(t),r(t))))}))}catch(e){console.log(e);const{message:t}=e;throw new Error("Error in processing your request:"+t)}}getCustomerBySenderEmailId(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=e.split("@");if(!(o&&o.length>0))return r("Invalid sender email id.");{o[0].toUpperCase();const s=`SELECT id,sender_email_id,domain_name FROM customer_information \n          where UPPER(domain_name) = "${o[1].toUpperCase()}"`;this.db.getConnectionPool().query(s,((o,s)=>{if(o)return r(o);console.log(s);let n=0;return s&&s.length>0?(s.map((t=>{t.sender_email_id&&-1!==t.sender_email_id.trim().toUpperCase().indexOf(e.trim().toUpperCase())&&(n=t.id)})),0!=n?t(n):r("Invalid sender email id, customer not found!")):r("Invalid sender email id, domain not found!")}))}}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getTemplateOrderItemDetailsByCustomerId(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`select fm.* from output_field_mapper as fm \n          where fm.is_header = 0\n          AND fm.customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):(console.log(o),t(this.getTemplateDetails(o,"DETAILS")))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getTemplateHeaderDetailsByCustomerId(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{const o=`SELECT md.* FROM mapper_detail as md \n          where md.is_header = 1\n          AND md.customer_id = ${e}`;this.db.getConnectionPool().query(o,((e,o)=>e?r(e):(console.log(o),t(this.getTemplateDetails(o,"HEADER")))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getAllOpenPurchaseOrders(){return o(this,void 0,void 0,(function*(){try{return new Promise(((e,t)=>{this.db.getConnectionPool().query("SELECT id,message_id, purchase_order_number, \n        json_file_name, json_file_path,email_from,\n        is_pdf_converted_to_json, DATE_FORMAT(created_at, '%Y-%m-%d') as created_at\n        FROM purchase_order_master WHERE DATE(created_at) = CURDATE() \n        AND purchase_order_number IS NULL",((r,o)=>r?t(r):(console.log(o),e(o))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}updatePurchaseOrderMasterInfo(e){return o(this,void 0,void 0,(function*(){try{return new Promise(((t,r)=>{this.db.getConnectionPool().query(`UPDATE purchase_order_master \n            SET\n              purchase_order_number = '${e.PurchaseOrderNumber}',            \n              is_json_parsed = true,\n              customer_id = ${e.CustomerId},\n              updated_at = CURDATE()\n            WHERE\n              id = ${e.Id}\n          `,((o,s)=>(o&&r("Error in updating PO Master with id:"+e.Id),t(s.affectedRows))))}))}catch(e){const{message:t}=e;throw new Error("Error in processing your request:"+t)}}))}getTemplateDetails(e,t){const r=new Array;return e&&e.length>0&&e.map((e=>{if("HEADER"===t){const t=new i.TemplateMapperInfoDto;t.Id=e.id,t.CustomerId=e.customer_id,t.IsHeader=e.is_header,t.InputFieldName=e.input_field_name,t.OutputFieldName=e.output_field_name,t.SeparatedBy=e.separated_by,t.MapperIndex=e.mapper_index,t.SearchTerm=e.search_term,r.push(t)}else{const t=new i.TemplateMapperInfoDto;t.Id=e.id,t.CustomerId=e.customer_id,t.IsHeader=e.is_header,t.OutputFieldName=e.name,e.column_index&&e.column_index>0&&(t.ColumnIndex=e.column_index-1),e.table_column_count&&e.table_column_count>0&&(t.OrderItemTableCount=e.table_column_count),t.FieldCount=e.field_count,r.push(t)}})),r}}},582:e=>{e.exports=require("cors")},974:e=>{e.exports=require("debug")},860:e=>{e.exports=require("express")},316:e=>{e.exports=require("express-winston")},738:e=>{e.exports=require("multer")},744:e=>{e.exports=require("mysql")},311:e=>{e.exports=require("node-cron")},681:e=>{e.exports=require("underscore")},773:e=>{e.exports=require("winston")},147:e=>{e.exports=require("fs")},685:e=>{e.exports=require("http")},282:e=>{e.exports=require("process")},837:e=>{e.exports=require("util")}},t={};!function r(o){var s=t[o];if(void 0!==s)return s.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(752)})();